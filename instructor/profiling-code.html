<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>HPC User: Profiling Code for Performance</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/incubator/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicons/incubator/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicons/incubator/favicon-16x16.png"><link rel="manifest" href="../favicons/incubator/site.webmanifest"><link rel="mask-icon" href="../favicons/incubator/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../profiling-code.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      HPC User
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            HPC User
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  HPC User
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 5%" class="percentage">
    5%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 5%" aria-valuenow="5" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../profiling-code.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. Introduction</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        2. Profiling Code for Performance
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#timing-a-program-externally">Timing a Program Externally</a></li>
<li><a href="#timing-internal-parts-of-a-program">Timing Internal Parts of a Program</a></li>
<li><a href="#what-to-time">What to Time</a></li>
<li><a href="#measuring-parallel-job-scaling">Measuring Parallel Job Scaling</a></li>
<li><a href="#tracking-memory-usage">Tracking Memory Usage</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="performance-concepts.html">3. Performance Concepts</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="parallel-concepts.html">4. Parallel Computing Concepts</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="multi-threaded.html">5. Multi-Threaded Programs</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="message-passing.html">6. Message-Passing Programs</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="language-survey.html">7. Language Survey</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="c-cpp.html">8. C and C++ Languages</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="fortran.html">9. The Fortran Language</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="python.html">10. The Python Language</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush12">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading12">
        <a href="r.html">11. The R Language</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush13">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading13">
        <a href="matlab.html">12. The Matlab Language</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush14">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading14">
        <a href="array-jobs.html">13. Array Jobs</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush15">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading15">
        <a href="gpus.html">14. Accelerating Scientific Computing with GPUs</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush16">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading16">
        <a href="high-throughput-computing.html">15. High-Throughput Computing</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush17">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading17">
        <a href="hpc-resources.html">16. HPC Resources</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/introduction.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/performance-concepts.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/introduction.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Introduction
        </a>
        <a class="chapter-link float-end" href="../instructor/performance-concepts.html" rel="next">
          Next: Performance Concepts...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Profiling Code for Performance</h1>
        <p>Last updated on 2025-09-17 |

        <a href="https://github.com/DrDaveTurner/HPC-User/edit/main/episodes/profiling-code.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 20 minutes</p>

        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How to measure performance?</li>
<li>How to measure memory usage?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Learn the different methods available to measure time and memory
usage externally and from within a program.</li>
<li>Understand what parts of a program are important to time.</li>
<li>Learn how to do a scaling study for multi-core and multi-node
jobs.</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>When we talk about the performance of a program, we are always
interested in how much time it takes to run, but in some cases we also
need to know how much memory the program uses if we are pushing the
limits of our computer. Even more than that, we often need to know how
much time each part of the code takes so that we know where to
concentrate our efforts as we try to improve the overall performance of
the program. So we need to be able to time the entire run, and also
internally each part of the code. For parallel codes, we also need to
know how efficiently they scale as we increase the number of cores or
compute nodes in order to determine what resources to request.</p>
<section><h2 class="section-heading" id="timing-a-program-externally">Timing a Program Externally<a class="anchor" aria-label="anchor" href="#timing-a-program-externally"></a></h2>
<hr class="half-width"><p>Linux has a <strong>time</strong> function that can proceed any
command, so this can be used to time the entire job externally even if
we don’t have access to the source code. This can be used to time a
short test run in order to estimate the run time needed for the complete
job. When we get to talking about parallel computing, or using multiple
compute cores to run a single job, the <strong>time</strong> function
will prove useful for getting the execution time for a job as it depends
on the number of cores. For example, it is common to test the same job
on 1, 4, 8, 16, and 32 cores to see how it scales with more cores to
determine what number of cores is most efficient to use.</p>
<p>Let’s start with a few simple examples of using the
<strong>time</strong> function at the command prompt. Try timing the
<strong>pwd</strong> command which prints the current working
directory.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="bu">time</span> pwd</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>/Users/daveturner

real	0m0.000s
user	0m0.000s
sys	0m0.000s</code></pre>
</div>
<p>The first thing you see is the output of the <strong>pwd</strong>
command, which in this case is the directory
<strong>/Users/daveturner</strong> on my Mac. Then the
<strong>time</strong> function prints its output, always as real time,
which is what we want, then user and system time which we can ignore.
This shows that the <strong>pwd</strong> command is faster than the
clock can measure. This is important to note that the
<strong>time</strong> command isn’t accurate to less than 1 millisecond,
so in general we should always make sure we are measuring execution
times that are greater than a second in general.</p>
<p>Below is another example where this time we are timing the
<strong>ls</strong> function which will list the files in the current
directory.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="bu">time</span> ls</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>file1 file2 file3

real	0m0.110s
user	0m0.006s
sys	0m0.027s</code></pre>
</div>
<p>When I do this on my Mac, I get a real time of just 0.006 seconds
because it’s really fast to access the local hard disk. The test above
is from a very large cluster computer that has a parallel file server
with 1 Petabyte of storage (1 Petabyte is 1000 Terabytes, and each
Terabyte is 1000 Gigabytes). The performance for accessing large files
on a parallel file server is very good, but it does take longer to do
small tasks like get the contents of the current directory. How does
this compare to the system you are on? On large HPC (High-Performance
Computing) systems like this cluster, the speed also depends on what
file system you are testing. You can usually access the local disk at
/tmp, but your home directory may be on another file system, and often
there is fast scratch space that is very high performance but only used
for programs when they are running.</p>
<p>Below we are going to use the <strong>sleep</strong> command to time
an interval of 5 seconds just to simulate what we might see in a real
job. In this case, even though the sleep function was supposed to go 5
seconds, there was some overhead or inaccuracy in the timing routine or
the length of the sleep. This is one thing that you always need to be
aware of when measuring performance. If you are measuring short things,
you may want to measure multiple times and take an average.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="bu">time</span> sleep 5</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>real	0m5.052s
user	0m0.001s
sys	0m0.003s</code></pre>
</div>
<p>In addition to worrying about the clock accuracy, you also need to
worry about interference from other jobs that may be running on the same
compute node you are on. The best way to time a real job is to test it
out on a completely isolated computer. If you are on an HPC system with
a batch queue, you can always request an entire compute node and then
just use part of the node you requested, even a single compute core. If
this is not possible, then try to get the job as isolated as you can.
Submitting a single-core request to a job queue is one example of this,
where you at least are sure that your job is the only one on the cores
that you requested. Your job will still be sharing the memory bus and L3
cache with other jobs. Jobs usually don’t effect each other much from
this, but they can. If your job is using the network to communicate with
other compute nodes, that might also be shared with other jobs running
on the same node. The single largest factor to be aware of is that other
jobs using the same file server as you are can definitely affect the
performance of your job if your code is doing lots of IO (Input and
Output). On HPC systems, this can be true even if the other jobs are not
on the same compute node as your job. If you want to isolate your job
from others in this case, you will need to do your IO to the local disk
(usually /tmp).</p>
</section><section><h2 class="section-heading" id="timing-internal-parts-of-a-program">Timing Internal Parts of a Program<a class="anchor" aria-label="anchor" href="#timing-internal-parts-of-a-program"></a></h2>
<hr class="half-width"><p>Every computer language has multiple clock functions that can be used
to time sections of the code. The syntax is different in each language,
but they all work about the same, and there is always a very high
precision function that is accurate down to somewhere in the nanosecond
range, though I typically don’t trust these for measuring less than a
microsecond interval. Each of these clock functions returns the current
time, so to measure the time in an interval you need to store the start
time, do some calculations or IO, then get the end time and subtract the
two to get the time used for that part of the code.</p>
<p>In Python since version 3.3, the best timer is in the
<strong>time</strong> package. To use it, you must start by importing
the package. In C/C++ the <strong>clock_gettime()</strong> function
returns the current time accurate to less than a microsecond. Accuracy
of other timers like <strong>SYSTEM CLOCK()</strong> in Fortran 90 vary
with the system and compiler. Below are examples of using the clock
functions to measure the time it takes to do a loop, then measure the
time it takes to dump an array out to a file.</p>
<div class="tabs">
<nav><div id="nav-tab-1" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-1-Python" name="Python" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-Python" type="button" role="tab" aria-controls="nav-tabpanel-1-Python" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-1-Python">
  Python
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-R" name="R" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-R" type="button" role="tab" aria-controls="nav-tabpanel-1-R" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-R">
  R
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-C" name="C" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-C" type="button" role="tab" aria-controls="nav-tabpanel-1-C" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-C">
  C
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-Fortran" name="Fortran" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-Fortran" type="button" role="tab" aria-controls="nav-tabpanel-1-Fortran" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-Fortran">
  Fortran
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-Matlab" name="Matlab" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-Matlab" type="button" role="tab" aria-controls="nav-tabpanel-1-Matlab" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-Matlab">
  Matlab
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-1" class="tab-content">
<div id="nav-tabpanel-1-Python" class="tab-pane show active" aria-labelledby="nav-tab-1-Python" role="tabpanel">
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># timing_example.py - Example code showing how to put timing around an IO loop.</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">1000000</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>array <span class="op">=</span> [ <span class="bu">float</span>(i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>( N ) ]</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>t_start <span class="op">=</span> time.perf_counter()</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="bu">sum</span> <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>( N ):</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>   <span class="bu">sum</span> <span class="op">+=</span> array[i]</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>t_loop <span class="op">=</span> time.perf_counter() <span class="op">-</span> t_start</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The loop took "</span>, t_loop, <span class="st">" seconds"</span>)</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>t_start <span class="op">=</span> time.perf_counter()</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>fd <span class="op">=</span> <span class="bu">open</span>( <span class="st">"array.out"</span>, <span class="st">"w"</span>)</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>( N ):</span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>   fd.write( <span class="bu">str</span>(array[i]) <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span> )</span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>fd.close()</span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a>t_output <span class="op">=</span> time.perf_counter() <span class="op">-</span> t_start</span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The output took "</span>, t_output, <span class="st">" seconds"</span>)</span></code></pre>
</div>
</div>
<div id="nav-tabpanel-1-R" class="tab-pane" aria-labelledby="nav-tab-1-R" role="tabpanel">
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># timing example code for R</span></span>
<span><span class="co"># USAGE:  Rscript timing_example.R</span></span>
<span></span>
<span></span>
<span>   <span class="co"># Allocate space for and initialize the array</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000000</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">vector</span><span class="op">(</span> <span class="st">"double"</span>, <span class="va">n</span> <span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span> <span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>   <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">as.double</span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span>   <span class="co"># Time a simple summation loop first</span></span>
<span></span>
<span><span class="va">dummy</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span> <span class="fl">1</span><span class="op">:</span><span class="fl">125000000</span> <span class="op">)</span>       <span class="co"># 1 GB of data to flush caches</span></span>
<span></span>
<span><span class="va">t_start</span> <span class="op">=</span> <span class="fu">proc.time</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">a_sum</span> <span class="op">&lt;-</span> <span class="fl">0.0</span></span>
<span><span class="kw">for</span><span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span> <span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>   <span class="va">a_sum</span> <span class="op">&lt;-</span> <span class="va">a_sum</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">t_end</span> <span class="op">=</span> <span class="fu">proc.time</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="fu">sprintf</span><span class="op">(</span><span class="st">"Summation with for loop took %6.3f seconds"</span>, <span class="va">t_end</span><span class="op">-</span><span class="va">t_start</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="fu">sprintf</span><span class="op">(</span><span class="st">"a_sum = %.6e for vector size %i"</span>, <span class="va">a_sum</span>, <span class="va">n</span> <span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span></span>
<span>   <span class="co"># Time the file write</span></span>
<span></span>
<span><span class="va">t_start</span> <span class="op">=</span> <span class="fu">proc.time</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">writeLines</span><span class="op">(</span> <span class="fu">as.character</span><span class="op">(</span> <span class="va">x</span> <span class="op">)</span>, <span class="st">"timing_example.out"</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">t_end</span> <span class="op">=</span> <span class="fu">proc.time</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="fu">sprintf</span><span class="op">(</span><span class="st">"File write for vector size %i took %6.3f seconds"</span>, <span class="va">n</span>, <span class="va">t_end</span><span class="op">-</span><span class="va">t_start</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div id="nav-tabpanel-1-C" class="tab-pane" aria-labelledby="nav-tab-1-C" role="tabpanel">
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">C<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode c" tabindex="0"><code class="sourceCode c"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co">// timing_example.c - Example code showing how to put timing around an IO loop</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/time.h&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="dt">int</span> main <span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>   <span class="dt">int</span> i<span class="op">,</span> N<span class="op">;</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>   <span class="dt">double</span> t_loop<span class="op">,</span> t_sum<span class="op">,</span> t_io<span class="op">,</span> a_sum<span class="op">,</span> <span class="op">*</span>array<span class="op">;</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>   <span class="kw">struct</span> timespec ts<span class="op">,</span> tf<span class="op">,</span> ts_sum<span class="op">,</span> tf_sum<span class="op">,</span> ts_io<span class="op">,</span> tf_io<span class="op">;</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>   <span class="dt">FILE</span> <span class="op">*</span>fd<span class="op">;</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>      <span class="co">// Allocate space for the array and initialize it</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>   N <span class="op">=</span> <span class="dv">1000000</span><span class="op">;</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>   array <span class="op">=</span> malloc<span class="op">(</span> N <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">double</span><span class="op">)</span> <span class="op">);</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a>   <span class="cf">for</span><span class="op">(</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> N<span class="op">;</span> i<span class="op">++</span> <span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a>      array<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="op">(</span><span class="dt">double</span><span class="op">)</span> i<span class="op">;</span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a>      <span class="co">// Put timing around our loop</span></span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a>   clock_gettime<span class="op">(</span>CLOCK_REALTIME<span class="op">,</span> <span class="op">&amp;</span>ts<span class="op">);</span></span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a>   a_sum <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a>   <span class="cf">for</span><span class="op">(</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> N<span class="op">;</span> i<span class="op">++</span> <span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a>      a_sum <span class="op">+=</span> array<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a>   clock_gettime<span class="op">(</span>CLOCK_REALTIME<span class="op">,</span> <span class="op">&amp;</span>tf<span class="op">);</span></span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a>   t_loop <span class="op">=</span>  <span class="op">(</span><span class="dt">double</span><span class="op">)</span> <span class="op">(</span> tf<span class="op">.</span>tv_sec <span class="op">-</span> ts<span class="op">.</span>tv_sec <span class="op">);</span></span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a>   t_loop <span class="op">+=</span> <span class="op">(</span><span class="dt">double</span><span class="op">)</span> <span class="op">(</span>tf<span class="op">.</span>tv_nsec <span class="op">-</span> ts<span class="op">.</span>tv_nsec<span class="op">)</span> <span class="op">*</span> <span class="fl">1e-9</span><span class="op">;</span></span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a></span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a>   printf<span class="op">(</span> <span class="st">"The loop took </span><span class="sc">%lf</span><span class="st"> seconds</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> t_loop <span class="op">);</span></span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a></span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a>      <span class="co">// Now time the file write</span></span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a></span>
<span id="cb9-41"><a href="#cb9-41" tabindex="-1"></a>   clock_gettime<span class="op">(</span>CLOCK_REALTIME<span class="op">,</span> <span class="op">&amp;</span>ts_io<span class="op">);</span></span>
<span id="cb9-42"><a href="#cb9-42" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" tabindex="-1"></a>   fd <span class="op">=</span> fopen<span class="op">(</span> <span class="st">"time_example.out"</span><span class="op">,</span> <span class="st">"w"</span> <span class="op">);</span></span>
<span id="cb9-44"><a href="#cb9-44" tabindex="-1"></a>   <span class="cf">for</span><span class="op">(</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> N<span class="op">;</span> i<span class="op">++</span> <span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-45"><a href="#cb9-45" tabindex="-1"></a>      fprintf<span class="op">(</span> fd<span class="op">,</span> <span class="st">"</span><span class="sc">%lf\n</span><span class="st">"</span><span class="op">,</span> array<span class="op">[</span>i<span class="op">]</span> <span class="op">);</span></span>
<span id="cb9-46"><a href="#cb9-46" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb9-47"><a href="#cb9-47" tabindex="-1"></a>   fclose<span class="op">(</span> fd <span class="op">);</span></span>
<span id="cb9-48"><a href="#cb9-48" tabindex="-1"></a></span>
<span id="cb9-49"><a href="#cb9-49" tabindex="-1"></a>   clock_gettime<span class="op">(</span>CLOCK_REALTIME<span class="op">,</span> <span class="op">&amp;</span>tf_io<span class="op">);</span></span>
<span id="cb9-50"><a href="#cb9-50" tabindex="-1"></a>   t_io <span class="op">=</span>  <span class="op">(</span><span class="dt">double</span><span class="op">)</span> <span class="op">(</span> tf_io<span class="op">.</span>tv_sec <span class="op">-</span> ts_io<span class="op">.</span>tv_sec <span class="op">);</span></span>
<span id="cb9-51"><a href="#cb9-51" tabindex="-1"></a>   t_io <span class="op">+=</span> <span class="op">(</span><span class="dt">double</span><span class="op">)</span> <span class="op">(</span>tf_io<span class="op">.</span>tv_nsec <span class="op">-</span> ts_io<span class="op">.</span>tv_nsec<span class="op">)</span> <span class="op">*</span> <span class="fl">1e-9</span><span class="op">;</span></span>
<span id="cb9-52"><a href="#cb9-52" tabindex="-1"></a></span>
<span id="cb9-53"><a href="#cb9-53" tabindex="-1"></a>   printf<span class="op">(</span> <span class="st">"The IO write took </span><span class="sc">%lf</span><span class="st"> seconds</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> t_io <span class="op">);</span></span>
<span id="cb9-54"><a href="#cb9-54" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</div>
<div id="nav-tabpanel-1-Fortran" class="tab-pane" aria-labelledby="nav-tab-1-Fortran" role="tabpanel">
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">FORTRAN<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode fortran" tabindex="0"><code class="sourceCode fortranfixed"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co">! timing_example.f90 - Example code showing how to put timing around an IO loop.</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="kw">PROGRAM</span> timing_example</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>   <span class="dt">INTEGER</span> <span class="dt">::</span> i, N, c_start, c_stop, c_rate, cs_start, cs_stop</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>   <span class="dt">INTEGER</span> <span class="dt">::</span> cio_start, cio_stop, fd</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>   <span class="dt">DOUBLE PRECISION</span> <span class="dt">::</span> t_sum, t_loop, a_sum, t_io</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>   <span class="dt">DOUBLE PRECISION</span>, <span class="dt">ALLOCATABLE</span> <span class="dt">::</span> array(:)</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>   <span class="dt">DOUBLE PRECISION</span>, <span class="dt">ALLOCATABLE</span> <span class="dt">::</span> dummy(:)</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>      <span class="co">! Allocate space for the array and initialize it</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>   N <span class="kw">=</span> <span class="dv">100000000</span>;</span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>   <span class="kw">ALLOCATE</span>( array(N) )</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>   <span class="kw">DO</span> i <span class="kw">=</span> <span class="dv">1</span>, N</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>      array(i) <span class="kw">=</span> i</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>   <span class="kw">END DO</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>      <span class="co">! Initialize a dummy array to clear cache</span></span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a>   <span class="kw">ALLOCATE</span>( dummy(<span class="dv">125000000</span>) )</span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a>   <span class="kw">DO</span> i <span class="kw">=</span> <span class="dv">1</span>, <span class="dv">125000000</span></span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a>      dummy(i) <span class="kw">=</span> <span class="fl">0.0</span></span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a>   <span class="kw">END DO</span></span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a>      <span class="co">! Put timing around our loop</span></span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a>   <span class="kw">CALL</span> <span class="fu">SYSTEM_CLOCK</span>( COUNT_RATE <span class="kw">=</span> c_rate )</span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a>   <span class="kw">CALL</span> <span class="fu">SYSTEM_CLOCK</span>( <span class="fu">COUNT</span> <span class="kw">=</span> c_start )</span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a>   <span class="co">!t_sum = 0.0</span></span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a>   a_sum <span class="kw">=</span> <span class="fl">0.0</span></span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a>   <span class="kw">DO</span> i <span class="kw">=</span> <span class="dv">1</span>, N</span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a>      <span class="co">!CALL SYSTEM_CLOCK( COUNT = cs_start )</span></span>
<span id="cb10-37"><a href="#cb10-37" tabindex="-1"></a>      a_sum <span class="kw">=</span> a_sum <span class="kw">+</span> array(i)</span>
<span id="cb10-38"><a href="#cb10-38" tabindex="-1"></a>      <span class="co">!CALL SYSTEM_CLOCK( COUNT = cs_stop )</span></span>
<span id="cb10-39"><a href="#cb10-39" tabindex="-1"></a>      <span class="co">!t_sum = t_sum + DBLE(cs_stop - cs_start) / c_rate</span></span>
<span id="cb10-40"><a href="#cb10-40" tabindex="-1"></a>   <span class="kw">END DO</span></span>
<span id="cb10-41"><a href="#cb10-41" tabindex="-1"></a></span>
<span id="cb10-42"><a href="#cb10-42" tabindex="-1"></a>   <span class="kw">CALL</span> <span class="fu">SYSTEM_CLOCK</span>( <span class="fu">COUNT</span> <span class="kw">=</span> c_stop )</span>
<span id="cb10-43"><a href="#cb10-43" tabindex="-1"></a>   t_loop <span class="kw">=</span> <span class="bu">DBLE</span>(c_stop <span class="kw">-</span> c_start) <span class="kw">/</span> c_rate</span>
<span id="cb10-44"><a href="#cb10-44" tabindex="-1"></a></span>
<span id="cb10-45"><a href="#cb10-45" tabindex="-1"></a>   <span class="fu">WRITE(*</span>,<span class="fu">*)</span> <span class="st">"a_sum = "</span>, a_sum</span>
<span id="cb10-46"><a href="#cb10-46" tabindex="-1"></a>   <span class="co">!WRITE(*,*) "The sum took ", t_sum, " seconds "</span></span>
<span id="cb10-47"><a href="#cb10-47" tabindex="-1"></a>   <span class="fu">WRITE(*</span>,<span class="fu">*)</span> <span class="st">"The loop took "</span>, t_loop, <span class="st">" seconds "</span></span>
<span id="cb10-48"><a href="#cb10-48" tabindex="-1"></a></span>
<span id="cb10-49"><a href="#cb10-49" tabindex="-1"></a>      <span class="co">! Now time the file write</span></span>
<span id="cb10-50"><a href="#cb10-50" tabindex="-1"></a></span>
<span id="cb10-51"><a href="#cb10-51" tabindex="-1"></a>   <span class="kw">CALL</span> <span class="fu">SYSTEM_CLOCK</span>( <span class="fu">COUNT</span> <span class="kw">=</span> cio_start, COUNT_RATE <span class="kw">=</span> c_rate )</span>
<span id="cb10-52"><a href="#cb10-52" tabindex="-1"></a></span>
<span id="cb10-53"><a href="#cb10-53" tabindex="-1"></a>   <span class="fu">open(</span> fd, <span class="fu">file</span> <span class="kw">=</span> <span class="st">"timing_example.out"</span> <span class="fu">)</span></span>
<span id="cb10-54"><a href="#cb10-54" tabindex="-1"></a>   <span class="kw">DO</span> i <span class="kw">=</span> <span class="dv">1</span>, N</span>
<span id="cb10-55"><a href="#cb10-55" tabindex="-1"></a>      <span class="fu">write(</span> fd, <span class="fu">*)</span> array(i)</span>
<span id="cb10-56"><a href="#cb10-56" tabindex="-1"></a>   <span class="kw">END DO</span></span>
<span id="cb10-57"><a href="#cb10-57" tabindex="-1"></a></span>
<span id="cb10-58"><a href="#cb10-58" tabindex="-1"></a>   <span class="fu">close(</span> fd <span class="fu">)</span></span>
<span id="cb10-59"><a href="#cb10-59" tabindex="-1"></a></span>
<span id="cb10-60"><a href="#cb10-60" tabindex="-1"></a>   <span class="kw">CALL</span> <span class="fu">SYSTEM_CLOCK</span>( <span class="fu">COUNT</span> <span class="kw">=</span> cio_stop )</span>
<span id="cb10-61"><a href="#cb10-61" tabindex="-1"></a>   t_io <span class="kw">=</span> <span class="bu">DBLE</span>(cio_stop <span class="kw">-</span> cio_start) <span class="kw">/</span> c_rate</span>
<span id="cb10-62"><a href="#cb10-62" tabindex="-1"></a></span>
<span id="cb10-63"><a href="#cb10-63" tabindex="-1"></a>   <span class="fu">WRITE(*</span>,<span class="fu">*)</span> <span class="st">"The IO write  took = "</span>, t_io, <span class="st">" seconds "</span></span></code></pre>
</div>
</div>
<div id="nav-tabpanel-1-Matlab" class="tab-pane" aria-labelledby="nav-tab-1-Matlab" role="tabpanel">
<p>Not implemented yet.</p>
</div>
</div>
</div>
<p>Try running the <strong>timing_example</strong> code yourself for the
language you are working with. These are codes you should have
downloaded and unzipped in your HPC system, and should be in the
<strong>code</strong> directory. Timing will be dependent on the
language, but the values I see are in the millisecond range. Since both
of these are above the nanosecond range, we can be confident that the
timing routine is accurately measuring each.</p>
<p>Let’s see what we can learn by playing around with it some more. When
I run the python version preceded by the Linux <strong>time</strong>
function, I see a real time significantly larger than the loop time and
output time combined. The initialization time is not measured but
shouldn’t be more than the loop time. What all this means is that there
is some startup time for getting the python program running and
importing the <strong>time</strong> package, but we may also be seeing
the lack of accuracy of the external <strong>time</strong> function when
it comes to measuring things down in the millisecond range. We do not
see the same time discrepancy when running the C version.</p>
<p>Now lets change the program itself. Sometimes we need to time a part
of something that is in a larger loop, so we need to sum the times
together. Try changing the timing so that it is inside the summation
loop instead of outside it to see what happens. You can do this by
uncommenting the timing and printing functions in the code file.</p>
<div class="tabs">
<nav><div id="nav-tab-2" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-2-Python" name="Python" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-Python" type="button" role="tab" aria-controls="nav-tabpanel-2-Python" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-2-Python">
  Python
  </h3>
</button>
<button class="nav-link" id="nav-tab-2-R" name="R" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-R" type="button" role="tab" aria-controls="nav-tabpanel-2-R" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-2-R">
  R
  </h3>
</button>
<button class="nav-link" id="nav-tab-2-C" name="C" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-C" type="button" role="tab" aria-controls="nav-tabpanel-2-C" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-2-C">
  C
  </h3>
</button>
<button class="nav-link" id="nav-tab-2-Fortran" name="Fortran" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-Fortran" type="button" role="tab" aria-controls="nav-tabpanel-2-Fortran" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-2-Fortran">
  Fortran
  </h3>
</button>
<button class="nav-link" id="nav-tab-2-Matlab" name="Matlab" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-Matlab" type="button" role="tab" aria-controls="nav-tabpanel-2-Matlab" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-2-Matlab">
  Matlab
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-2" class="tab-content">
<div id="nav-tabpanel-2-Python" class="tab-pane show active" aria-labelledby="nav-tab-2-Python" role="tabpanel">
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>array <span class="op">=</span> [ <span class="bu">float</span>(i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>( N ) ]</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>t_start <span class="op">=</span> time.perf_counter()</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="bu">sum</span> <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>t_sum <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>( N ):</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>   t0 <span class="op">=</span> time.perf_counter()</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>   <span class="bu">sum</span> <span class="op">+=</span> array[i]</span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>   t_sum <span class="op">+=</span> time.perf_counter() <span class="op">-</span> t0</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>t_loop <span class="op">=</span> time.perf_counter() <span class="op">-</span> t_start</span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The sum took "</span>, t_sum, <span class="st">" seconds"</span>)</span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The loop took "</span>, t_loop, <span class="st">" seconds"</span>)</span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a>t_start <span class="op">=</span> time.perf_counter()</span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a>fd <span class="op">=</span> <span class="bu">open</span>( <span class="st">"array.out"</span>, <span class="st">"w"</span>)</span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>( N ):</span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a>   fd.write( <span class="bu">str</span>(array[i]) <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span> )</span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a>fd.close()</span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a>t_output <span class="op">=</span> time.perf_counter() <span class="op">-</span> t_start</span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The output took "</span>, t_output, <span class="st">" seconds"</span>)</span></code></pre>
</div>
</div>
<div id="nav-tabpanel-2-R" class="tab-pane" aria-labelledby="nav-tab-2-R" role="tabpanel">
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># timing example code with internal loop timings for R</span></span>
<span><span class="co">#   This shows how to do this, but demonstrates that it can be very intrusive</span></span>
<span><span class="co"># USAGE:  Rscript timing_example2.R</span></span>
<span></span>
<span></span>
<span>   <span class="co"># Allocate space for and initialize the array</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000000</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">vector</span><span class="op">(</span> <span class="st">"double"</span>, <span class="va">n</span> <span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span> <span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>   <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">as.double</span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span>   <span class="co"># Time a simple summation loop with internal timing as well</span></span>
<span></span>
<span><span class="va">dummy</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span> <span class="fl">1</span><span class="op">:</span><span class="fl">125000000</span> <span class="op">)</span>       <span class="co"># 1 GB of data to flush caches</span></span>
<span></span>
<span><span class="va">t_sum</span> <span class="op">&lt;-</span> <span class="fl">0.0</span></span>
<span><span class="va">t_start</span> <span class="op">=</span> <span class="fu">proc.time</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">a_sum</span> <span class="op">&lt;-</span> <span class="fl">0.0</span></span>
<span><span class="kw">for</span><span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span> <span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>   <span class="va">t_0</span> <span class="op">=</span> <span class="fu">proc.time</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span>   <span class="va">a_sum</span> <span class="op">&lt;-</span> <span class="va">a_sum</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>   <span class="va">t_sum</span> <span class="op">=</span> <span class="va">t_sum</span> <span class="op">+</span> <span class="op">(</span> <span class="fu">proc.time</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">t_0</span> <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">t_end</span> <span class="op">=</span> <span class="fu">proc.time</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="fu">sprintf</span><span class="op">(</span><span class="st">"Internal sums took %6.3f seconds"</span>, <span class="va">t_sum</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="fu">sprintf</span><span class="op">(</span><span class="st">"For loop with internal timing too took %6.3f seconds"</span>, <span class="va">t_end</span><span class="op">-</span><span class="va">t_start</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="fu">sprintf</span><span class="op">(</span><span class="st">"a_sum = %.6e for vector size %i"</span>, <span class="va">a_sum</span>, <span class="va">n</span> <span class="op">)</span> <span class="op">)</span></span></code></pre>
</div>
</div>
<div id="nav-tabpanel-2-C" class="tab-pane" aria-labelledby="nav-tab-2-C" role="tabpanel">
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">C<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode c" tabindex="0"><code class="sourceCode c"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co">// timing_example.c - Example code showing how to put timing around an IO loop.</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/time.h&gt;</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="dt">int</span> main <span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>   <span class="dt">int</span> i<span class="op">,</span> N<span class="op">;</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>   <span class="dt">double</span> t_loop<span class="op">,</span> t_sum<span class="op">,</span> t_io<span class="op">,</span> a_sum<span class="op">,</span> <span class="op">*</span>array<span class="op">;</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>   <span class="kw">struct</span> timespec ts<span class="op">,</span> tf<span class="op">,</span> ts_sum<span class="op">,</span> tf_sum<span class="op">,</span> ts_io<span class="op">,</span> tf_io<span class="op">;</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>   <span class="dt">FILE</span> <span class="op">*</span>fd<span class="op">;</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>      <span class="co">// Allocate space for the array and initialize it</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>   N <span class="op">=</span> <span class="dv">1000000</span><span class="op">;</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>   array <span class="op">=</span> malloc<span class="op">(</span> N <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">double</span><span class="op">)</span> <span class="op">);</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a>   <span class="cf">for</span><span class="op">(</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> N<span class="op">;</span> i<span class="op">++</span> <span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a>      array<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="op">(</span><span class="dt">double</span><span class="op">)</span> i<span class="op">;</span></span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a>      <span class="co">// Put timing around our loop</span></span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a>   clock_gettime<span class="op">(</span>CLOCK_REALTIME<span class="op">,</span> <span class="op">&amp;</span>ts<span class="op">);</span></span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a>   a_sum <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a>   t_sum <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a>   <span class="cf">for</span><span class="op">(</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> N<span class="op">;</span> i<span class="op">++</span> <span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a>      clock_gettime<span class="op">(</span>CLOCK_REALTIME<span class="op">,</span> <span class="op">&amp;</span>ts_sum<span class="op">);</span></span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a>      a_sum <span class="op">+=</span> array<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb13-33"><a href="#cb13-33" tabindex="-1"></a>      clock_gettime<span class="op">(</span>CLOCK_REALTIME<span class="op">,</span> <span class="op">&amp;</span>tf_sum<span class="op">);</span></span>
<span id="cb13-34"><a href="#cb13-34" tabindex="-1"></a>      t_sum <span class="op">=</span>  <span class="op">(</span><span class="dt">double</span><span class="op">)</span> <span class="op">(</span> tf_sum<span class="op">.</span>tv_sec <span class="op">-</span> ts_sum<span class="op">.</span>tv_sec <span class="op">);</span></span>
<span id="cb13-35"><a href="#cb13-35" tabindex="-1"></a>      t_sum <span class="op">+=</span> <span class="op">(</span><span class="dt">double</span><span class="op">)</span> <span class="op">(</span>tf_sum<span class="op">.</span>tv_nsec <span class="op">-</span> ts_sum<span class="op">.</span>tv_nsec<span class="op">)</span> <span class="op">*</span> <span class="fl">1e-9</span><span class="op">;</span></span>
<span id="cb13-36"><a href="#cb13-36" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb13-37"><a href="#cb13-37" tabindex="-1"></a></span>
<span id="cb13-38"><a href="#cb13-38" tabindex="-1"></a>   clock_gettime<span class="op">(</span>CLOCK_REALTIME<span class="op">,</span> <span class="op">&amp;</span>tf<span class="op">);</span></span>
<span id="cb13-39"><a href="#cb13-39" tabindex="-1"></a>   t_loop <span class="op">=</span>  <span class="op">(</span><span class="dt">double</span><span class="op">)</span> <span class="op">(</span> tf<span class="op">.</span>tv_sec <span class="op">-</span> ts<span class="op">.</span>tv_sec <span class="op">);</span></span>
<span id="cb13-40"><a href="#cb13-40" tabindex="-1"></a>   t_loop <span class="op">+=</span> <span class="op">(</span><span class="dt">double</span><span class="op">)</span> <span class="op">(</span>tf<span class="op">.</span>tv_nsec <span class="op">-</span> ts<span class="op">.</span>tv_nsec<span class="op">)</span> <span class="op">*</span> <span class="fl">1e-9</span><span class="op">;</span></span>
<span id="cb13-41"><a href="#cb13-41" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" tabindex="-1"></a>   printf<span class="op">(</span> <span class="st">"The sum took </span><span class="sc">%lf</span><span class="st"> seconds</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> t_sum <span class="op">);</span></span>
<span id="cb13-43"><a href="#cb13-43" tabindex="-1"></a>   printf<span class="op">(</span> <span class="st">"The loop took </span><span class="sc">%lf</span><span class="st"> seconds</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> t_loop <span class="op">);</span></span>
<span id="cb13-44"><a href="#cb13-44" tabindex="-1"></a></span>
<span id="cb13-45"><a href="#cb13-45" tabindex="-1"></a>      <span class="co">// Now time the file write</span></span>
<span id="cb13-46"><a href="#cb13-46" tabindex="-1"></a></span>
<span id="cb13-47"><a href="#cb13-47" tabindex="-1"></a>   clock_gettime<span class="op">(</span>CLOCK_REALTIME<span class="op">,</span> <span class="op">&amp;</span>ts_io<span class="op">);</span></span>
<span id="cb13-48"><a href="#cb13-48" tabindex="-1"></a></span>
<span id="cb13-49"><a href="#cb13-49" tabindex="-1"></a>   fd <span class="op">=</span> fopen<span class="op">(</span> <span class="st">"time_example.out"</span><span class="op">,</span> <span class="st">"w"</span> <span class="op">);</span></span>
<span id="cb13-50"><a href="#cb13-50" tabindex="-1"></a>   <span class="cf">for</span><span class="op">(</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> N<span class="op">;</span> i<span class="op">++</span> <span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-51"><a href="#cb13-51" tabindex="-1"></a>      fprintf<span class="op">(</span> fd<span class="op">,</span> <span class="st">"</span><span class="sc">%lf\n</span><span class="st">"</span><span class="op">,</span> array<span class="op">[</span>i<span class="op">]</span> <span class="op">);</span></span>
<span id="cb13-52"><a href="#cb13-52" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb13-53"><a href="#cb13-53" tabindex="-1"></a>   fclose<span class="op">(</span> fd <span class="op">);</span></span>
<span id="cb13-54"><a href="#cb13-54" tabindex="-1"></a></span>
<span id="cb13-55"><a href="#cb13-55" tabindex="-1"></a>   clock_gettime<span class="op">(</span>CLOCK_REALTIME<span class="op">,</span> <span class="op">&amp;</span>tf_io<span class="op">);</span></span>
<span id="cb13-56"><a href="#cb13-56" tabindex="-1"></a>   t_io <span class="op">=</span>  <span class="op">(</span><span class="dt">double</span><span class="op">)</span> <span class="op">(</span> tf_io<span class="op">.</span>tv_sec <span class="op">-</span> ts_io<span class="op">.</span>tv_sec <span class="op">);</span></span>
<span id="cb13-57"><a href="#cb13-57" tabindex="-1"></a>   t_io <span class="op">+=</span> <span class="op">(</span><span class="dt">double</span><span class="op">)</span> <span class="op">(</span>tf_io<span class="op">.</span>tv_nsec <span class="op">-</span> ts_io<span class="op">.</span>tv_nsec<span class="op">)</span> <span class="op">*</span> <span class="fl">1e-9</span><span class="op">;</span></span>
<span id="cb13-58"><a href="#cb13-58" tabindex="-1"></a></span>
<span id="cb13-59"><a href="#cb13-59" tabindex="-1"></a>   printf<span class="op">(</span> <span class="st">"The IO write took </span><span class="sc">%lf</span><span class="st"> seconds</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> t_io <span class="op">);</span></span>
<span id="cb13-60"><a href="#cb13-60" tabindex="-1"></a><span class="op">}</span></span></code></pre>
</div>
</div>
<div id="nav-tabpanel-2-Fortran" class="tab-pane" aria-labelledby="nav-tab-2-Fortran" role="tabpanel">
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">FORTRAN<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode fortran" tabindex="0"><code class="sourceCode fortranfixed"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co">! timing_example.f90 - Example code showing how to put timing around an IO loop.</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="kw">PROGRAM</span> timing_example</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>   <span class="dt">INTEGER</span> <span class="dt">::</span> i, N, c_start, c_stop, c_rate, cs_start, cs_stop</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>   <span class="dt">INTEGER</span> <span class="dt">::</span> cio_start, cio_stop, fd</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>   <span class="dt">DOUBLE PRECISION</span> <span class="dt">::</span> t_sum, t_loop, a_sum, t_io</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>   <span class="dt">DOUBLE PRECISION</span>, <span class="dt">ALLOCATABLE</span> <span class="dt">::</span> array(:)</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>      <span class="co">! Allocate space for the array and initialize it</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>   N <span class="kw">=</span> <span class="dv">100000000</span>;</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>   <span class="kw">ALLOCATE</span>( array(N) )</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>   <span class="kw">DO</span> i <span class="kw">=</span> <span class="dv">1</span>, N</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>      array(i) <span class="kw">=</span> i</span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>   <span class="kw">END DO</span></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>      <span class="co">! Put timing around our loop</span></span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a>   <span class="kw">CALL</span> <span class="fu">SYSTEM_CLOCK</span>( COUNT_RATE <span class="kw">=</span> c_rate )</span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a>   <span class="kw">CALL</span> <span class="fu">SYSTEM_CLOCK</span>( <span class="fu">COUNT</span> <span class="kw">=</span> c_start )</span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a></span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a>   t_sum <span class="kw">=</span> <span class="fl">0.0</span></span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a>   a_sum <span class="kw">=</span> <span class="fl">0.0</span></span>
<span id="cb14-26"><a href="#cb14-26" tabindex="-1"></a>   <span class="kw">DO</span> i <span class="kw">=</span> <span class="dv">1</span>, N</span>
<span id="cb14-27"><a href="#cb14-27" tabindex="-1"></a>      <span class="kw">CALL</span> <span class="fu">SYSTEM_CLOCK</span>( <span class="fu">COUNT</span> <span class="kw">=</span> cs_start )</span>
<span id="cb14-28"><a href="#cb14-28" tabindex="-1"></a>      a_sum <span class="kw">=</span> a_sum <span class="kw">+</span> array(i)</span>
<span id="cb14-29"><a href="#cb14-29" tabindex="-1"></a>      <span class="kw">CALL</span> <span class="fu">SYSTEM_CLOCK</span>( <span class="fu">COUNT</span> <span class="kw">=</span> cs_stop )</span>
<span id="cb14-30"><a href="#cb14-30" tabindex="-1"></a>      t_sum <span class="kw">=</span> t_sum <span class="kw">+</span> <span class="bu">DBLE</span>(cs_stop <span class="kw">-</span> cs_start) <span class="kw">/</span> c_rate</span>
<span id="cb14-31"><a href="#cb14-31" tabindex="-1"></a>   <span class="kw">END DO</span></span>
<span id="cb14-32"><a href="#cb14-32" tabindex="-1"></a></span>
<span id="cb14-33"><a href="#cb14-33" tabindex="-1"></a>   <span class="kw">CALL</span> <span class="fu">SYSTEM_CLOCK</span>( <span class="fu">COUNT</span> <span class="kw">=</span> c_stop )</span>
<span id="cb14-34"><a href="#cb14-34" tabindex="-1"></a>   t_loop <span class="kw">=</span> <span class="bu">DBLE</span>(c_stop <span class="kw">-</span> c_start) <span class="kw">/</span> c_rate</span>
<span id="cb14-35"><a href="#cb14-35" tabindex="-1"></a></span>
<span id="cb14-36"><a href="#cb14-36" tabindex="-1"></a>   <span class="fu">WRITE(*</span>,<span class="fu">*)</span> <span class="st">"a_sum = "</span>, a_sum</span>
<span id="cb14-37"><a href="#cb14-37" tabindex="-1"></a>   <span class="fu">WRITE(*</span>,<span class="fu">*)</span> <span class="st">"The sum took "</span>, t_sum, <span class="st">" seconds "</span></span>
<span id="cb14-38"><a href="#cb14-38" tabindex="-1"></a>   <span class="fu">WRITE(*</span>,<span class="fu">*)</span> <span class="st">"The loop took "</span>, t_loop, <span class="st">" seconds "</span></span>
<span id="cb14-39"><a href="#cb14-39" tabindex="-1"></a></span>
<span id="cb14-40"><a href="#cb14-40" tabindex="-1"></a>      <span class="co">! Now time the file write</span></span>
<span id="cb14-41"><a href="#cb14-41" tabindex="-1"></a></span>
<span id="cb14-42"><a href="#cb14-42" tabindex="-1"></a>   <span class="kw">CALL</span> <span class="fu">SYSTEM_CLOCK</span>( <span class="fu">COUNT</span> <span class="kw">=</span> cio_start, COUNT_RATE <span class="kw">=</span> c_rate )</span>
<span id="cb14-43"><a href="#cb14-43" tabindex="-1"></a></span>
<span id="cb14-44"><a href="#cb14-44" tabindex="-1"></a>   <span class="fu">open(</span> fd, <span class="fu">file</span> <span class="kw">=</span> <span class="st">"timing_example.out"</span> <span class="fu">)</span></span>
<span id="cb14-45"><a href="#cb14-45" tabindex="-1"></a>   <span class="kw">DO</span> i <span class="kw">=</span> <span class="dv">1</span>, N</span>
<span id="cb14-46"><a href="#cb14-46" tabindex="-1"></a>      <span class="fu">write(</span> fd, <span class="fu">*)</span> array(i)</span>
<span id="cb14-47"><a href="#cb14-47" tabindex="-1"></a>   <span class="kw">END DO</span></span>
<span id="cb14-48"><a href="#cb14-48" tabindex="-1"></a></span>
<span id="cb14-49"><a href="#cb14-49" tabindex="-1"></a>   <span class="fu">close(</span> fd <span class="fu">)</span></span>
<span id="cb14-50"><a href="#cb14-50" tabindex="-1"></a></span>
<span id="cb14-51"><a href="#cb14-51" tabindex="-1"></a>   <span class="kw">CALL</span> <span class="fu">SYSTEM_CLOCK</span>( <span class="fu">COUNT</span> <span class="kw">=</span> cio_stop )</span>
<span id="cb14-52"><a href="#cb14-52" tabindex="-1"></a>   t_io <span class="kw">=</span> <span class="bu">DBLE</span>(cio_stop <span class="kw">-</span> cio_start) <span class="kw">/</span> c_rate</span>
<span id="cb14-53"><a href="#cb14-53" tabindex="-1"></a></span>
<span id="cb14-54"><a href="#cb14-54" tabindex="-1"></a>   <span class="fu">WRITE(*</span>,<span class="fu">*)</span> <span class="st">"The IO write  took = "</span>, t_io, <span class="st">" seconds "</span></span>
<span id="cb14-55"><a href="#cb14-55" tabindex="-1"></a></span>
<span id="cb14-56"><a href="#cb14-56" tabindex="-1"></a><span class="kw">END PROGRAM</span> timing_example</span></code></pre>
</div>
</div>
<div id="nav-tabpanel-2-Matlab" class="tab-pane" aria-labelledby="nav-tab-2-Matlab" role="tabpanel">
<p>Not implemented yet.</p>
</div>
</div>
</div>
<p>In my computer, the <strong>t_sum</strong> time is only a bit larger
than the <strong>t_loop</strong> time from before, but remember that
this doesn’t count the loop overhead. If we look at the
<strong>t_loop</strong> time instead, in my computer it is more than
double what it was before. When the clock routine is measuring very
small intervals each time, it can be intrusive in that it distorts the
measurement by increasing the run time of the entire code. It isn’t
surprising that this is intrusive since we are measuring the time it
takes to retrieve a single array element and do one addition. The code
is doing a subtraction and addition itself to calculate the time
interval, so it is probably more surprising that doing the timing in
this way is not more intrusive.</p>
</section><section><h2 class="section-heading" id="what-to-time">What to Time<a class="anchor" aria-label="anchor" href="#what-to-time"></a></h2>
<hr class="half-width"><p>The goal is to fully profile your code so that you understand where
all the time is being spent. This means timing each computational
section where time is being spent, usually the loops for example. While
simple print statements may not be important contributors to the overall
run time of a code, any large input or output from files may be. When we
start talking about parallel programs that use multiple cores or even
multiple compute nodes it will become important to measure the time
taken in communicating data to other cores and other nodes. Once you
have a complete profile of where time is being spent, then you can
understand where to start in trying to optimize your program to make it
run faster.</p>
</section><section><h2 class="section-heading" id="measuring-parallel-job-scaling">Measuring Parallel Job Scaling<a class="anchor" aria-label="anchor" href="#measuring-parallel-job-scaling"></a></h2>
<hr class="half-width"><p>When we get to talking about multi-processor jobs it will be very
important to understand how efficiently a job scales as we use more
processing cores. For this we will do what is called a scaling study
where we measure the performance of a typical job using different number
of processing cores. We may for example run on 1 core, then 4, 8, 16,
and 32 cores to see how efficiently the job scales as we apply more
processing power. This is done so that we can understand how many cores
we can efficiently apply to that job. If we get a 7 times speedup on 8
cores compared to 1, that less than ideal but still very good. If we
then see a 9 times speedup using 16 cores, then we’d probably want to
stick with using just 8 cores on that particular job. Do keep in mind
that scaling is very dependent on the problem size. Larger problems will
typically scale better to more cores, while smaller problems may be
limited to only a few cores. The goal is to determine how many cores we
can use with reasonable efficiency. The same kind of scaling study can
also be used for multi-node jobs, where we would test the performance on
1 node, 2, 4, and 8 nodes for example.</p>
<p>Problem size is one factor that can affect the scaling efficiency.
For multi-node jobs, choosing the fastest networking options, and
ensuring that all compute nodes are on the same network switch can both
increase the scaling efficiency.</p>
</section><section><h2 class="section-heading" id="tracking-memory-usage">Tracking Memory Usage<a class="anchor" aria-label="anchor" href="#tracking-memory-usage"></a></h2>
<hr class="half-width"><p>When we think about high performance, we mostly think about running
jobs faster. For some programs, the memory usage may be the factor
limiting what types of science we can do. At the very least, we need to
know what memory to request when submitting jobs to a batch
scheduler.</p>
<p>For simple jobs, like the matrix multiplication code in the next
section, we can calculate the exact memory requirements. If we are going
to multiply two matrices of size NxN and put the results in a third,
then each matrix takes NxN x 8 Bytes if the elements are 64-bit floats,
so the total memory required would be 3 x NxN * 8 Bytes.</p>
<p>For more complicated programs, often the best approach is to do a
short test run to measure the memory use before submitting the full job.
This is especially true if you are submitting lots of similar jobs. If
your job goes over the requested memory, it is most often killed, so you
want to over estimate the request somewhat, but if you request too much
it can take a lot longer to get your job scheduled and result in
inefficient use of the resources as you will be locking up memory that
you are not using.</p>
<p>Measuring the memory usage is more difficult than it should be on
most systems, and it depends on what tools you have available. If you
are on an HPC system with a batch scheduler like Slurm, you can use the
<strong>sstat</strong> command to find the current memory usage for a
running job and <strong>seff</strong> to find the maximum memory used
for a completed job, using the job ID number in both cases to choose the
job you are interested in.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">seff</span> 5072064</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Job ID: 5072064
Cluster: beocat
User/Group: daveturner/daveturner_users
State: FAILED (exit code 16)
Cores: 1
CPU Utilized: 00:01:07
CPU Efficiency: 97.10% of 00:01:09 core-walltime
Job Wall-clock time: 00:01:09
Memory Utilized: 2.26 GB
Memory Efficiency: 11.31% of 20.00 GB</code></pre>
</div>
<p>The matrix multiplication job above used 10,000x10,000 matrices and
took 1 minute 9 seconds. We see that in this case it used 2.26 GB of
memory. One thing to keep in mind is that 1 GB can be calculated in
different ways. In this case, 1 kB is 1024 Bytes, 1 MB is 1024 x 1024
Bytes, and 1 GB is 1024 x 1024 x 1024 Bytes. So 3 matrices are 3 x NxN x
8 / (1024x1024x1024) GB = 2.235 GB, rounded up to 2.26 GB. In general,
if you estimate 1 GB as 10^9 Bytes that works fine.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">sstat</span> <span class="at">--format</span><span class="op">=</span>MaxRSS 5072069</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>MaxRSS
----------
  2289.50M</code></pre>
</div>
<p>For a running job you can use the <strong>sstat</strong> command with
the job ID number. The <strong>sstat</strong> command will dump a lot of
information out, so using the <strong>–format=MaxRSS</strong> parameter
provides just the real memory that we want. In this case, it is again
2.29 GB.</p>
<p>Different HPC systems may have batch queue systems other than Slurm,
but all will have similar methods of getting the memory usage for
running and completed jobs. If you are not running a job through a batch
system, you can use the <strong>htop</strong> command to find your
process and look at the <strong>Res</strong> or resident memory. This
works best for single-core jobs as multi-core jobs may show memory usage
for each thread.</p>
<p><strong>Ganglia</strong> is another option providing a web-based
interface to look at memory usage over time. If you have access to
Ganglia on your HPC system, it provides a node view only rather than a
job view, so it is only really useful if your job is the only one
running on a given compute node. However, being able to see the memory
use over time can be very helpful.</p>
<p>We will practice these approaches more in the upcoming modules.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul><li>The <strong>time</strong> function can always be used externally to
measure performance but has limited accuracy of around 1
millisecond.</li>
<li>Internally there are precise clock routines that can be used to
measure the performance of each part of a code. These are different for
each programming language, but the use is always the same.</li>
<li>Scaling studies can help determine how many cores or nodes we can
efficiently use for a parallel job of a given problem size.</li>
<li>Measuring memory use can be done from outside a program, but you may
also be able to calculate total memory for simple programs.</li>
</ul></div>
</div>
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/introduction.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/performance-concepts.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/introduction.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Introduction
        </a>
        <a class="chapter-link float-end" href="../instructor/performance-concepts.html" rel="next">
          Next: Performance Concepts...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/DrDaveTurner/HPC-User/edit/main/episodes/profiling-code.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/DrDaveTurner/HPC-User/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/DrDaveTurner/HPC-User/" class="external-link">Source</a></p>
				<p><a href="https://github.com/DrDaveTurner/HPC-User/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:drdaveturner@gmail.com">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.17.1" class="external-link">sandpaper (0.17.1)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.7" class="external-link">varnish (1.0.7)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://DrDaveTurner.github.io/HPC-User/instructor/profiling-code.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": " HPC, software, lesson, The Carpentries, Python, C, C++, Fortran, R, Matlab",
  "name": "Profiling Code for Performance",
  "creativeWorkStatus": "active",
  "url": "https://DrDaveTurner.github.io/HPC-User/instructor/profiling-code.html",
  "identifier": "https://DrDaveTurner.github.io/HPC-User/instructor/profiling-code.html",
  "dateCreated": "2022-01-01",
  "dateModified": "2025-09-17",
  "datePublished": "2025-10-07"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

